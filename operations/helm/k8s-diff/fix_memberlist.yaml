---
patch_rules:

- name: "Adjust gossip-ring to match"
  /metadata/name: [gossip-ring]
  match:
  - op: remove
    path: /spec/publishNotReadyAddresses
  steps:
  - op: remove
    path: /spec/publishNotReadyAddresses
  - op: remove
    path: /metadata/labels
  - op: remove
    path: /spec/selector/name

- name: "Rename /spec/selector/app.kubernetes.io/part-of=memberlist to gossip_ring_member=true"
  /spec/selector/app.kubernetes.io~1part-of: [memberlist]
  steps:
  - op: remove
    path: "/spec/selector/app.kubernetes.io~1part-of"
  - op: add
    path: "/spec/selector/gossip_ring_member"
    value: "true"

- name: "Rename /spec/template/metadata/labels/app.kubernetes.io/part-of=memberlist to gossip_ring_member=true"
  /spec/template/metadata/labels/app.kubernetes.io~1part-of: [memberlist]
  steps:
  - op: remove
    path: "/spec/template/metadata/labels/app.kubernetes.io~1part-of"
  - op: add
    path: "/spec/template/metadata/labels/gossip_ring_member"
    value: "true"

- remove_field: /metadata/labels/app.kubernetes.io~1part-of

- name: "Remove memberlist port from services"
  /kind: [Service]
  /spec/ports/2/port: [7946]
  steps:
  - op: remove
    path: /spec/ports/2

